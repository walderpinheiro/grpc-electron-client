#!/usr/bin/env node
var path=require("path"),fs=require("fs");const filesObj={};function fromDir(s,e){if(!fs.existsSync(s))return void console.log("no dir ",s);const r=fs.readdirSync(s);r.forEach((c,i)=>{const o=path.join(s,r[i]);if(fs.lstatSync(o).isDirectory())fromDir(o,e);else if(o.indexOf(e)>=0){const s=o.replace(/^.*[\\\/]/,""),e=fs.readFileSync(o).toString("base64");filesObj[s.replace(/\.[^\/.]+$/,"")]=e}})}if(fromDir(process.cwd()+"/src",".proto"),Object.keys(filesObj).length>0){fs.existsSync(process.cwd()+"/src/grpc")||fs.mkdirSync(process.cwd()+"/src/grpc"),fs.writeFileSync(process.cwd()+"/src/grpc/proto.json",JSON.stringify(filesObj));const s=Object.keys(filesObj).map(s=>({[s.toUpperCase()]:s})).reduce((s,e)=>({...s,...e}),{}),e=`export default Object.freeze(${JSON.stringify(s)})`;fs.writeFileSync(process.cwd()+"/src/grpc/index.js",e)}
